"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports[Symbol.toStringTag]="Module";var l=require("typescript"),c=require("react"),E=require("react-dom");function g(t){return t&&typeof t=="object"&&"default"in t?t:{default:t}}var a=g(l),f=g(c),S=g(E);function b(t){let e=t;for(;e.parent;){if(a.default.isFunctionDeclaration(e))return e;if(a.default.isSourceFile(e))return null;e=e.parent}return null}function h(t){return e=>{const n=o=>{const r=a.default.visitEachChild(o,n,e);return a.default.isJsxOpeningElement(r)||a.default.isJsxSelfClosingElement(r)?j(t,r):r};return o=>a.default.factory.updateSourceFile(o,a.default.visitNodes(o.statements,n))}}const x=[/^[a-z]+$/];function j(t,e){if(a.default.isIdentifier(e.tagName)){const n=e.tagName.getText();if(!(t.target??x).some(v=>v.test(n)))return e;const r=e.getSourceFile(),s=r.fileName,d=a.default.getLineAndCharacterOfPosition(r,e.getStart(r)),i=e.kind===a.default.SyntaxKind.JsxOpeningElement?l.factory.createJsxOpeningElement:l.factory.createJsxSelfClosingElement,u=b(e),p=`${s.replace(t.projectRoot,"")}:${d.line+1}:${d.character+1}${u?` | [${u.name?.getText()}]`:""}`;let m=null;return t.inlineCode&&(m=e.getText()),i(e.tagName,e.typeArguments,l.factory.updateJsxAttributes(e.attributes,[...e.attributes.properties,l.factory.createJsxAttribute(l.factory.createIdentifier("data-sj-path"),l.factory.createStringLiteral(`idea://open?file=${encodeURIComponent(s)}&line=${d.line+1}&column=${d.character+1}`)),l.factory.createJsxAttribute(l.factory.createIdentifier("data-sj-display-name"),l.factory.createStringLiteral(p)),...m?[l.factory.createJsxAttribute(l.factory.createIdentifier("data-sj-code"),l.factory.createStringLiteral(encodeURIComponent(m)))]:[]]))}return e}const C=a.default.createPrinter();function L(t){return{enforce:"pre",transform(e,n){if(n.endsWith(".tsx")){const o=a.default.createSourceFile(n,e,a.default.ScriptTarget.Latest,!0,a.default.ScriptKind.TSX),r=a.default.transform(o,[h(t)]);return C.printNode(a.default.EmitHint.SourceFile,r.transformed[0],r.transformed[0])}}}}function J(){return{enforce:"pre",transform(t,e){if(e.endsWith(".ts")||e.endsWith(".tsx")){const n=encodeURIComponent(t);return t+`
//@ts-ignore
(globalThis.__files||={})['${e}'] = decodeURIComponent("${n}");`}}}}function R(){const[t,e]=c.useState(null),[n,o]=c.useState(!1);return c.useEffect(()=>{let r=null;const s=()=>{r!=null&&clearTimeout(r),!n&&o(!0),r=setTimeout(()=>{o(!1),r=null},100)},d=i=>{if(i.target instanceof HTMLElement){if(i.target.closest("[data-sj-ui]"))return;let u=i.target;u.dataset.sjPath||(u=u.closest("[data-sj-path]")),u==null?e(null):t!==u&&e(i.target)}};return addEventListener("mouseover",d),addEventListener("scroll",s),addEventListener("resize",s),()=>{removeEventListener("mouseover",d),removeEventListener("scroll",s),removeEventListener("resize",s)}},[]),n?null:t}function y(){const t=c.useRef(null),e=R(),[n,o]=c.useState(!1),[r,s]=c.useState(null);c.useEffect(()=>{const i=()=>{o(!1)},u=m=>{m.key==="Shift"&&o(!0)},p=m=>{m.key==="Shift"&&o(!1)};return addEventListener("blur",i),addEventListener("keydown",u),addEventListener("keyup",p),()=>{removeEventListener("blur",i),removeEventListener("keydown",u),removeEventListener("keyup",p)}},[]),c.useEffect(()=>{if(!e||!t.current)return;const i=e.getBoundingClientRect();s({rect:i,sjPath:e.dataset.sjPath,sjDisplayName:e.dataset.sjDisplayName,sjCode:e.dataset.sjCode&&decodeURIComponent(e.dataset.sjCode)})},[e,s,t]);const d=e&&n;return f.default.createElement("div",{ref:t,style:{position:"fixed",background:"rgba(255,255,0,0.1)",visibility:d?"visible":"hidden",display:"grid",placeItems:"center",userSelect:"none",pointerEvents:"none",outline:"0.2rem dotted gray",boxSizing:"border-box",isolation:"isolate",left:r?.rect.left,top:r?.rect.top,width:r?.rect.width,height:r?.rect.height,cursor:"pointer"}},f.default.createElement("div",{style:{background:"rgba(0,0,255,0.5)",color:"#fff",padding:5,zIndex:1,borderRadius:4,pointerEvents:"auto"},onClick:()=>{const i=document.createElement("a");i.href=r?.sjPath,i.click()}},"\u{1F517} ",r?.sjDisplayName),r?.sjCode&&f.default.createElement("div",{style:{position:"absolute",right:0,bottom:0,fontFamily:"menlo, monospace",background:"rgba(0,0,255,0.8)",color:"white",borderRadius:2,padding:3,boxSizing:"border-box",zIndex:1,width:"100%",overflow:"scroll"}},f.default.createElement("pre",null,f.default.createElement("code",null,r?.sjCode))))}function k(){const[t,e]=c.useState(null);return c.useEffect(()=>{const n=document.createElement("div");return n.style.isolation="isolation",n.style.pointerEvents="none",n.dataset.sjUi="true",document.body.appendChild(n),e(n),()=>{e(null),n.remove()}},[]),t==null?f.default.createElement(f.default.Fragment,null):S.default.createPortal(f.default.createElement(y,null),t)}exports.SourceJumpOverlay=y;exports.SourceJumpOverlayPortal=k;exports.embedSource=J;exports.tsxSourceJump=L;
